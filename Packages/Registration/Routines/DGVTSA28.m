DGVTSA28 ;7DELTA/KDC - VTS Stand alone Option routine ;07-MAR-2012
 ;;5.3;REGISTRATION;**853**;07-MAR-2012;Build 104
 ;
 ; Integration Agreements Utilized:
 ;  START, EXC, STOP^RGHLLOG - #2796
 ;  BLDEVN, BLDPD1, BLDPID^VAFCQRY - #3630
 ;
A28(DFN) ;BUILD AND SEND A28
 N RESLT,CNT,MPI,EVN,TCNT,ERR,PD1,PID
 N HL,MTIEN,HLDT,HLDT1,HLL,HLMID,HLNEXT
 K HLA("HLA"),HLA("HLS")
 S CNT=1
 D INIT^HLFNC2("DG VTS ADT-A28 SERVER",.HL)
 I $O(HL(""))="" Q "-1^"_$P(HL,"^",2)
 S HLECH=HL("ECH"),HLFS=HL("FS"),COMP=$E(HL("ECH"),1),REP=$E(HL("ECH"),2),SUBCOMP=$E(HL("ECH"),4)
 D CREATE^HLTF(.HLMID,.MTIEN,.HLDT,.HLDT1)
 S ERR="",TCNT=0
 N NODE
 S EVN(1)=$$EVN^VAFHLEVN("A28",4,)
 Q:ERR'="" ERR
 D BLDPID^VAFCQRY(DFN,1,"ALL",.PID,.HL,.ERR)
 Q:ERR'="" ERR
 S PD1(1)=$$EN^VAFHLPD1(DFN,",3,")
 Q:ERR'="" ERR
 S HLA("HLS",1)=EVN(1)
 S HLA("HLS",3)=PD1(1)
 S CNT=0 F  S CNT=$O(PID(CNT)) Q:CNT=""  D
 .I CNT=1 S HLA("HLS",2)=PID(CNT)
 .I CNT>1 S HLA("HLS",2,CNT-1)=PID(CNT)
 S HLA("HLS",4)=$$EN1^VAFHLZPD(DFN,"1,17,21,34")
 S HLL("LINKS",1)="DG VTS ADT-A28 CLIENT^AITC_VTS"
 D GENERATE^HLMA("DG VTS ADT-A28 SERVER","LM",1,.RESLT,MTIEN)
 K HLA,HLEID,HLL("LINKS"),COMP,REP,SUBCOMP,HLECH,HLFS,HLA("HLA"),HLA("HLS"),MPIFRSLT
 Q

PSO7P667 ;DAL/MHA - Post Install routine for patch PSO*7*667 ;12/30/2021
 ;;7.0;OUTPATIENT PHARMACY;**667**;DEC 1997;Build 18
 Q
EN ;
 ;D PUT^XPAR("SYS","PSOEPCS EXPIRED DEA FAILOVER",1,1)
 ;
 N BY,ENTRY,ERR,ROOT,WHEN,DUZ
 N DIFROM
 S DUZ=.5
 ;
 ; Check to see if PSO EPCS PSDRPH AUDIT is already scheduled.
 K ROOT D OPTSTAT^XUTMOPT("PSO EPCS PSDRPH AUDIT",.ROOT)
 I $D(ROOT(1)),$P(ROOT(1),"^",2)'="",$P(ROOT(1),"^",3)'="" G CONT1
 ;
 ; Change from XU EPCS PSDRPH AUDIT to PSO EPCS PSDRPH AUDIT
 K ROOT D OPTSTAT^XUTMOPT("XU EPCS PSDRPH AUDIT",.ROOT)
 I $D(ROOT(1)) F ENTRY=1:1:ROOT D
 . I $P(ROOT(ENTRY),"^",2)="" Q
 . I $P(ROOT(ENTRY),"^",3)="" Q
 . S WHEN=$P(ROOT(ENTRY),"^",2),BY=$P(ROOT(ENTRY),"^",3)
 . D RESCH^XUTMOPT("PSO EPCS PSDRPH AUDIT",WHEN,"",BY,"L",.ERR)
 . D RESCH^XUTMOPT("XU EPCS PSDRPH AUDIT","@","","@","",.ERR)
CONT1 ;
 ;
 ; Check to see if PSO EPCS LOGICAL ACCESS is already scheduled.
 K ROOT D OPTSTAT^XUTMOPT("PSO EPCS LOGICAL ACCESS",.ROOT)
 I $D(ROOT(1)),$P(ROOT(1),"^",2)'="",$P(ROOT(1),"^",3)'="" G CONT2
 ;
 ; Change from XU EPCS LOGICAL ACCESS to PSO EPCS LOGICAL ACCESS
 K ROOT D OPTSTAT^XUTMOPT("XU EPCS LOGICAL ACCESS",.ROOT)
 I $D(ROOT(1)) F ENTRY=1:1:ROOT D
 . I $P(ROOT(ENTRY),"^",2)="" Q
 . I $P(ROOT(ENTRY),"^",3)="" Q
 . S WHEN=$P(ROOT(ENTRY),"^",2),BY=$P(ROOT(ENTRY),"^",3)
 . D RESCH^XUTMOPT("PSO EPCS LOGICAL ACCESS",WHEN,"",BY,"L",.ERR)
 . D RESCH^XUTMOPT("XU EPCS LOGICAL ACCESS","@","","@","",.ERR)
CONT2 ;
 Q
